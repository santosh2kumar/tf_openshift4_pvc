; Zone file for the cluster's domain.
;
$TTL 12H
@                      IN   SOA   ns hostmaster (
                                  ${zone_serial_number}              ; serial
                                  1H                      ; refresh (1 hour)
                                  15M                     ; retry   (15 minutes)
                                  1W                      ; expiry  (1 week)
                                  1H )                    ; nx = nxdomain RRL (1 hour)
                       IN   NS    ns
ns                     IN   A     ${external_zone_dns_ip}
;
; A records for the API as referenced externally and by cluster nodes. Both point to
; the KEG's load balancer, using either its external address or cluster-internal
; address as the case may be.
;
api                    IN   A     ${load_balancer_external_ip}
api-int                IN   A     ${load_balancer_internal_ip}
;
; The wildcard A record for ingress also points to the load balancer.
;
*.apps                 IN   A     ${ingress_external_ip}
;
; The ETCd cluster lives on the masters.  We need an appropraitely-named
; A record for each master node that's in that cluster.
;
%{ for m in masters ~}
etcd-${m.index}                 IN   A     ${m.ip}
%{ endfor ~}
;
; And now the SRV records that premit cluster/service lookup.  Details here matter, note
; the trailing dot on thses records is important.
;
%{ for m in masters ~}
_etcd-server-ssl._tcp  IN   SRV   0 10 2380 etcd-${m.index}.${cluster_zone}.
%{ endfor ~}

%{ for m in masters ~}
master-${m.index}     IN   A     ${m.ip}
%{ endfor ~}
%{ for w in workers ~}
worker-${w.index}     IN   A     ${w.ip}
%{ endfor ~}

bootstrap         IN   A     ${bootstrap_ip}
